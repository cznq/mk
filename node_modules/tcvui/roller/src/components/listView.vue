<template>
	<td :name="item.name" :index="indexs">
		<div class="fed-roller-ul" :style="{height:ulHeight+'px'}" @touchstart.prevent="eventTouchStart($event)" @touchmove.prevent.stop="eventTouchMove($event)" @touchend="eventTouchEnd($event)">
			<ul :style="ulStyle">
				<li v-for="(ii, index) in data" :class="{actives : (index== itemActive)}" :key="index" :style="{height:lhi+'px', lineHeight:lhi+'px'}">
					<span> {{ii[1]}} </span>
				</li>
			</ul>
		</div>
	</td>
</template>
<script>
import eventHelper from './eventHandler'
function getActives(active, data) {
	let act = 0;
	for (let i = 0; i < data.length; i++) {
		let ones = data[i]
		if (ones[0] == active || ones[1] == active) {
			act = i;
			break
		}
	}
	return act;
}
function getTransformStyle() {
	let { larger, mHeight, item, lhi, moveTime } = this,
		active = item.selected ? getActives(item.selected, item.data) : 0,
		_height = ((larger ? 2 : 1) - active) * lhi;

	return {
		style: {
			transition: `all ${moveTime || 0}s ease-out`,
			transform: `translate3d(0,${mHeight || _height}px,0)`
		},
		heights: mHeight || _height
	}

}
export default {
	name: 'RollerListView',
	props: ["item", "larger", "lhi", "indexs", "selectChange"],
	components: {
	},
	data() {
		//   this.bb()
		// let item = this.item,
		// 	data = item.data,
		// 	active = item.indexs ? item.indexs : (item.selected ? getActives(item.selected, data) : 0),
		// 	getStyle = getTransformStyle.call(this);

		// let lineNum = this.larger ? 2 : 1,
		// 	lens = data.length,
		// 	mins = -(lens - lineNum - 1) * this.lhi,
		// 	maxs = lineNum * this.lhi;
		var result = this.transformItem();
		return {
			mins: result.mins,
			name: result.name,
			maxs: result.maxs,
			itemActive: result.itemActive,
			ulHeight: result.ulHeight,
			data: result.data,
			moveHeight: result.moveHeight,  //实时位置
			ulStyle: result.ulStyle,
			moveTime: 0, //位移滚动的时间
			mHeight: 0, //手动移动 过程中存储的高度值
		}
	},

	beforeCreate() {
	},
	destroyed() {
	},
	methods: {
		btnClick(isok) {
			this.$emit('callback', !!isok)
		},
		eventTouchStart(e) {
			if (this.data.length < 2) {
				return;
			}
			eventHelper.ListTouchStart.call(this, e)
		},
		eventTouchMove(e) {

			eventHelper.ListlTouchMove.call(this, e)
		},
		eventTouchEnd(e) {
			let that = this;
			eventHelper.ListTouchEnd.call(this, e, (val) => {
				that.itemActive = val - 1
				this.$emit('selectChange', this.name, that.data[that.itemActive], that.itemActive)
			})
		},
		transformItem (){
			let item = this.item,
				data = item.data,
				active = item.indexs ? item.indexs : (item.selected ? getActives(item.selected, data) : 0),
				getStyle = getTransformStyle.call(this);

			let lineNum = this.larger ? 2 : 1,
				lens = data.length,
				mins = -(lens - lineNum - 1) * this.lhi,
				maxs = lineNum * this.lhi;
			
			return {
				mins,
				name: item.name,
				maxs,
				itemActive: active,
				ulHeight: this.lhi * (this.larger ? 5 : 3),
				data: data,
				moveHeight: getStyle.heights,  //实时位置
				ulStyle: getStyle.style
			}
		}
	},
	watch: {
		item (){

			let result = this.transformItem()
			this.mins = result.mins;
			this.name = result.name;
			this.maxs = result.maxs;
			this.itemActive = result.itemActive;
			this.ulHeight = result.ulHeight;
			this.data = result.data;
			this.moveHeight = result.moveHeight;  //实时位置
			this.ulStyle = result.ulStyle;
			this.moveTime = 0; //位移滚动的时间
			this.mHeight = 0; //手动移动 过程中存储的高度值
		}
	}
}
</script>

